### 常见单位
- pt(point): 磅，绝对长度单位，1pt=1/72英寸(in)
- px(pixel): 像素，相对长度单位，屏幕上显示的最小单位，1px=1/96英寸(in)
- em: 相对于父元素字体的大小
- rem: 相对于根元素字体的大小
- ppi(dpi): pixel(dot) per inch，每英寸可以显示的像素点数，即屏幕像素密度
### 设备独立像素(device independent pixel)
设备独立像素是一个**虚拟像素单位**，也叫做**逻辑像素**，独立于设备的用于逻辑上衡量长度的单位，由底层系统程序使用，会适当的转换为物理像素，在web开发中，我们用的**CSS像素**就可看成设备独立像素，当我们给一个`div`的宽高分别设置为`375px和667px`时，这里的`px`就是逻辑像素  
### 物理像素(设备像素)
物理像素就是常说的(像素)分辨率大小，例如分辨率为`2160px*1440px`的屏幕，横向有2160个像素点，纵向有1440个像素点，一起来充满整个屏幕区域，在屏幕出厂的那天起，它上面的物理像素点就固定不变了
### dpr(devicePixelRatio)
**在屏幕未被缩放的状态下(缩放比例为1)**，设备像素(物理像素)与设备独立像素的比值==> **dpr=物理像素/设备独立像素**  
  
在web开发的时候，dpr又可以表示为： 物理像素/css像素的比值`(只是一个方向上，水平方向或垂直方向)`
#### 来个例子 
苹果3GS和苹果4s的尺寸都是3.5寸，但苹果3GS的分辨是320x480，而苹果4s的分辨率是640x960，在尺寸相同的屏幕上，不同机型包含的物理像素点的数目却不一致  
  
  
假如我们按照320物理像素进行布局，那么在640像素的手机上就会有一半的空白，为了能使得网页在不同分辨率的手机上显示状态不改变，所以出现了虚拟像素单位，也就是逻辑像素来解决该问题  
  

统一苹果3GS和苹果4s都是320个虚拟像素，只是在苹果3GS上，最终 1 个逻辑像素换算成 1 个物理像素，在苹果4s中，1 个逻辑像素最终换算成 2 个物理像素。   
  
**所以在一个方向上时：**  
- dpr=1时，1个CSS像素 = 1个逻辑像素 = 1个物理像素
- dpr=2时，1个CSS像素 = 1个逻辑像素 = 2个物理像素    
- dpr=3时，1个CSS像素 = 1个逻辑像素 = 3个物理像素
**针对x和y方向，也就是面积时**：dpr=2，1个CSS像素覆盖4个物理像素点；dpr=3，1个CSS像素覆盖9个物理像素点    
  

进一步直观的理解dpr：**一个CSS像素覆盖x个物理像素，这个数值x称为dpr**  
例如：在我的matebook13电脑上(分辨率是2160*1440)，dpr=1.5，则一个CSS像素覆盖1.5个物理像素，所以我把一个div的宽高分别设置为1440px和960px时，这个div的大小可以铺满整个屏幕
  

在JS中，我们可以用`screen.width 和screen.height`来获取屏幕的CSS像素，用`window.devicePixelRatio`来获取屏幕的dpr值，用`window.devicePixelRatio * screen.width`获取屏幕的像素分辨率大小  
### viewport(视口)
viewport指的是浏览器上用来显示网页的那部分区域，即用户在浏览网页的可视区域 
#### 视口的特点
视口的大小是可变的  


在PC端，视口的大小一般是指浏览器窗口的大小(不包括滚动条、菜单栏、书签之类的), 而在移动端(窄屏幕)设备中，会在一个虚拟窗口或视口中渲染页面，这个窗口或视口通常比屏幕宽，然后在缩小渲染的页面，以便在一屏内显示所有的内容，用户可以通过移动或缩放来查看页面的不同区域  

  
例如：若是移动屏幕的宽度为640px，则可能会用980px的虚拟视口来渲染页面，接着在缩小页面以适应640px的窗口大小，以便在一屏内显示所有内容，这里说到的虚拟视口指的是**布局视口**  
#### 视口类型 
- 布局视口(layout viewport): 网页布局的基准窗口，在PC端指的是当前浏览器窗口的大小(不包括滚动条、菜单栏、书签之类的)，而在移动端，布局视口默认值大部分为980px，**特点如上**，可以通过`document.documentElement.clientWidth/clientHeight`获取
- 可见视口(viusal viewport): 用户可见的网页区域
- 理想视口(ideal viewport): 理想的布局视口，将布局视口的宽度设为当前屏幕的宽度即为理想视口尺寸
### 缩放
dpr公式成立的前提是缩放比例为1，当你用双指缩放页面的时候，实际上放大或缩小的是CSS像素，而物理像素是固定不变的，一个40px*40px的`div`，当我们将页面放大两倍时，此时一个CSS像素所占的面积覆盖着4个物理像素所占的面积：宽放大2倍x高放大两倍，所以`div`那块区域，在我们看起来是变大了的
> 缩放：缩小放大的对象是CSS像素
### 测试
#### 现象
苹果6/7/8的像素分辨率是750px，则设计稿大小按照750px进行设计，设计稿上有一个图片的宽为300px，  
而我们程序员在还原网页时发现，苹果6/7/8的布局视口只有375px的大小`(设置了width=device-width)`，按照原来300px宽的图像进行还原显然不对，会使得图片看起来变大了
#### 原因
这是因为设计稿上的页面布局是按照`物理像素`进行的，而我们在苹果6/7/8上还原该页面时用的是CSS像素，苹果6/7/8的布局视口我们设置为与设备屏幕大小一致=>宽为375px，表示用375个CSS像素可以充满屏幕宽度，而苹果6/7/8的`dpr=2`，则`1个CSS像素`等于`2个物理像素`，所以375个CSS像素就等于750个物理像素，也就可以充满整个屏幕的宽度，当我们想要还原300px宽的图像时，设置的CSS像素应该为`300/dpr(2)=150px`  
#### 解决    
如果每次我们都要自己去计算实际编写的CSS像素，这就太麻烦了，利用`缩放`特性可以让浏览器自己帮我们去做，即为：`initial-scale=1/dpr`，这样在我们编写的时候：`1个CSS像素`就等于`1个物理像素`，这样就可以直接将设计稿上的像素值设置为CSS像素
#### 如图
测试机器是苹果6/7/8，假定设计稿上设计的图片宽都为300个物理像素大小，第一张图缩放比例为`1`，第二张图缩放比例为`1/dpr=0.5`(第二张图是我们要的效果)，还原设计稿时的效果如下：
![缩放比例为1的示意图](https://raw.githubusercontent.com/pumpkinduan/FigureBed/master/img/20200323104104.png)  
![缩放比例为0.5的示意图](https://raw.githubusercontent.com/pumpkinduan/FigureBed/master/img/20200323104514.png)
#### 代码设置
```js
let meta = document.createElement('meta');
let scale = 1 / window.devicePixelRatio;// CSS像素的缩放比例
meta.setAttribute('name', 'viewport');
meta.setAttribute('content', `width=device-width,initial-scale=${scale}, user-scalable=no, maximum-scale=${scale}, minimum-scale=${scale}`);
document.head.append(meta);
document.documentElement.setAttribute('data-dpr', window.devicePixelRatio);
```
### 参考资料
- [移动端开发的兼容适配](https://juejin.im/post/5d70747cf265da03e16897c8)
- [分辨率相关](https://github.com/FatliTalk/blog/issues/58)
- [一点关于移动端开发的知识](https://juejin.im/post/5aa39d5e518825558358d8f3)