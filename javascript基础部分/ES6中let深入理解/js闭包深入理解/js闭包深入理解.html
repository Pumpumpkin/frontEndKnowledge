<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600587 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="397"/>

<div>
<span><div><span style="font-size: 11pt;">废话不多说,直接进入本文的正题-</span>---&gt;<span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(255, 0, 0);-evernote-highlight:true;">闭包(Closure)</span></div><div><br/></div><div><br/></div><div><span style="font-size: 12pt; color: rgb(121, 121, 121);">百度百科对于闭包的定义</span><span style="font-size: 12pt; color: rgb(121, 121, 121);">:</span> <span style="letter-spacing: normal;orphans: 2;text-indent: 28px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(70, 70, 70); font-family: arial, 宋体, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;-evernote-highlight:true;">闭包就是能够读取其他函数内部变量的函数;</span></span></div><div><span style="color: rgb(70, 70, 70); font-family: arial;"><span style="font-size: 12pt; color: rgb(70, 70, 70); font-family: arial;">MDN对闭包的定义:</span> <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, arial, x-locale-body, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;-evernote-highlight:true;">闭包是函数和声明该函数的词法环境的组合。</span></span></span></span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">这么官方的解释对于笔者而言甚是懵懂啊,所以笔者结合了大量的文章以及代码的调试,来好好谈谈闭包吧!!!</span></div><div><br/></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">首先,我的理解是</span><span style="font-size: 14pt; color: rgb(227, 0, 0); font-family: &quot;Open Sans&quot;;">:闭包实质上是一个对象,该对象内部有个属性对应着一个包含了一系列变量和函数名的对象的引用</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">在挖掘闭包前,咱们先来好好认识几个小伙伴,他们都是js引擎在工作时要拜访的,并且是闭包形成的必要条件</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">注意:以下说的VO/AO对象是ES3中出现的机制,而在ES5中引入了词法环境对象来管理执行环境下的一系列变量,这里不作表述,但实质是一样的。</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">1.执行期上下文，又叫执行环境(Execution Context)</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">2.作用域:函数在定义时就形成的规则,规定了在函数的外部无法访问函数内部的数据,而函数内部的子函数可以访问,数据指的是var变量声明和函数声明</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">3.作用域链</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">4.变量对象||活动对像</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">5.函数的[[scopes]]属性,一个隐式的属性，仅供js引擎使用</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">6.预执行</span></div><div><br/></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">1.1.<span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">执行环境(Execution Context):</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    a1(分类).有两种环境,一种全局的执行环境(只有一个),一种局部执行环境,也就是函数的执行期环境(调用一次创建一个)</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    a2(定义):通俗的来说,执行环境就是代码在运行时所处的环境</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    a3(包含的部分):VO对象，作用域链，js代码</span></span></div><div><br/></div><div><span style="font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">2.1变量对象(VO):</span><span style="font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">若是全局环境变量对象为GO对象(gobal object),若是在函数执行环境,变量对象为VO</span></div><div><span style="font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">2.2活动对象(AO):当函数预编译完后开始执行函数时,VO转为AO,并且在该对象里会确定arguments</span><span style="font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; box-sizing: border-box; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">。</span></div><div><span style="font-size: 14.6667px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 70, 53); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">总结:AO与VO实质为同一东西,只是在函数执行前后有个转化过程,都收集了对应的环境中的变量声明和函数声明,当需要用到环境中的某个变量时都会从这里面找。</span></div><div><font color="#A8A8A8" style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(168, 168, 168); font-family: &quot;Open Sans&quot;; font-weight: bold;">------------------------------------------------------------------------------------------------------------------------</span></font></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">下面从js预执行(预解析)开始出发，</span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(235, 0, 115); font-family: &quot;Open Sans&quot;;">&lt;script&gt;</span></span></div><div><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;;"><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">   </span> <span style="font-size: 11pt; font-family: &quot;Open Sans&quot;;">console.log(a);</span></span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;"> </span> <span style="font-size: 11pt; color: rgb(198, 197, 0); font-family: &quot;Open Sans&quot;;"> </span> <span style="font-size: 11pt; color: rgb(54, 101, 238); font-family: &quot;Open Sans&quot;;">var a  = 1</span><span style="font-size: 11pt; color: rgb(198, 197, 0); font-family: &quot;Open Sans&quot;;">;</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">        function aa(x, y) {</span></div><div><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;;"><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">   </span> <span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(54, 101, 238);">var name = 'pum';</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(54, 101, 238); font-family: &quot;Open Sans&quot;;">                var sex = 'male;</span></span></div><div><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;;"><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">   </span> <span style="font-size: 11pt; font-family: &quot;Open Sans&quot;;">function girl() {</span></span></div><div><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;;"><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">       </span> <span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(54, 101, 238);">var age = '18';</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">   </span> <span style="font-size: 11pt; background-color: rgb(255, 250, 165); color: rgb(128, 128, 255); font-family: &quot;Open Sans&quot;;-evernote-highlight:true;">console.log(name);</span></span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">                        function kid() {</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">                                var subject = 'math';</span></div><div><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;;"><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">   </span> <span style="font-size: 11pt; background-color: rgb(255, 250, 165); font-family: &quot;Open Sans&quot;; color: rgb(129, 182, 255);-evernote-highlight:true;">console.log(age);</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    }</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">                        kid();</span></span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">                }</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">                function boy() {</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;"> </span> <span style="font-size: 11pt; color: rgb(227, 0, 0); font-family: &quot;Open Sans&quot;;"> </span> <span style="background-color: rgb(255, 250, 165); font-size: 11pt; color: rgb(227, 0, 0); font-family: &quot;Open Sans&quot;;-evernote-highlight:true;">console.log(sex)</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">                }</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">                girl();</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">                boy();</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">        }</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">        aa(22, 33);</span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(235, 0, 115); font-family: &quot;Open Sans&quot;;">&lt;/script&gt;</span></span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">3.1.首先浏览器会加载这段js代码，然后看看有没有简单的语法错误(如:中文符号),接着在正式解析执行代码之前进行全局的预解析阶段，</span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">     <span style="background-color: rgb(255, 250, 165); font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;-evernote-highlight:true;">全局的预解析:</span></span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">            a.首先创建一个全局的执行环境，在该环境里创建两个东西，</span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">            a.1</span><span style="font-size: 11pt; color: rgb(26, 173, 224); font-family: &quot;Open Sans&quot;;">.变量对象</span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">，若是全局环境该变量对象也叫GO对象(gobal object),为了区别开来,在全局环境中我把VO直接叫做GO</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    a.2</span><span style="font-size: 11pt; color: rgb(26, 173, 224); font-family: &quot;Open Sans&quot;;">作用域链<span style="font-size: 12pt; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;;">ScopeChain</span></span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">(注意:该作用域链属于执行环境内部的),理解为执行环境的属性名</span></span></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">            b.接着js解释器会查找全局环境中的变量声明,函数声明,并把他们作为GO对象的属性名,其中变量声明的变量名值为undefined,函数<span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">声明的名值赋予函数体</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">            如:在以上代码中，GO = { a:undefined, aa: function(){...}},GO对象就是window对象。</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;;"><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">    </span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(51, 51, 51);">   </span> <span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; color: rgb(241, 79, 154);">注意顺序:先变量声明，然后函数声明</span></span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(241, 79, 154); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(241, 79, 154); font-family: &quot;Open Sans&quot;;">    </span><span style="font-size: 11pt; color: rgb(241, 79, 154); font-family: &quot;Open Sans&quot;;">   </span> <span style="font-size: 11pt; font-family: &quot;Open Sans&quot;;">c.预解析完后,该GO对象会成为全局执行环境的</span><span style="font-size: 12pt; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;;">ScopeChain</span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;;">的第一位</span><span style="font-size: 14.6667px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">,即:Scope = {0: GO}</span></span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt;"><span style="font-size: 11pt;"><span style="font-size: 14.6667px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">            d.接着生成的全局上下文被放入一个叫做执行环境栈的结构中去,等待执行期的到来</span></span></span></span></div><div><br/></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;"><span style="font-size: 14.6667px; font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51);">   </span> <font style="font-size: 12pt;"><span style="font-size: 12pt; background-color: rgb(255, 250, 165); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51);-evernote-highlight:true;">在全局的预解析阶段发现了aa函数的定义,那么js引擎就会为aa函数添加一个</span><span style="font-size: 11pt; background-color: rgb(255, 250, 165); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51);-evernote-highlight:true;">隐式的属性[[Scopes]]，若是全局函数,那么初始化其值的第0位为GO对象,即:  aa.<span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; background-color: rgb(255, 250, 165); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51);-evernote-highlight:true;">[[Scopes]] = { 0:GO }</span></span></font></span></div><div><img src="js闭包深入理解_files/GO.png" type="image/png" data-filename="GO.png" style="background-color: rgb(255, 250, 165); font-family: Open Sans; font-size: 11pt; color: rgb(51, 51, 51);"/></div><div><br/></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt;"><span style="font-size: 11pt;"><span style="font-size: 14.6667px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14.6667px; color: rgb(255, 70, 53); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">总结: </span></span></span></span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt;"><span style="font-size: 11pt;"><span style="font-size: 14.6667px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14.6667px; color: rgb(255, 70, 53); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">    1.全局的预解析完后创建了一个全局的执行环境,该环境中包含了---&gt;</span><span style="font-size: 14.6667px; color: rgb(129, 182, 255); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">GO对象,</span><span style="font-size: 11pt;"><span style="font-size: 11pt; color: rgb(129, 182, 255); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">作用域链</span><span style="font-size: 12pt; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">ScopeChain</span><span style="font-size: 11pt; color: rgb(129, 182, 255); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">,以及要执行的js代码</span><span style="font-size: 11pt; font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">,环境中的</span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">变量声明和<span style="font-size: 14.6667px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">函数</span><span style="box-sizing: border-box; font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">声明以key-value形式挂到GO里,而GO作为Scope的第0位。</span></span></span></span></span></span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 11pt;"><span style="font-size: 11pt;"><span style="font-size: 14.6667px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 11pt;"><span style="font-size: 11pt;"><span style="box-sizing: border-box; font-size: 11pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">    2.在全局的预解析阶段初始化定义在全局环境中的函数(全局函数)的[[Scopes]]属性值为GO对象,该值为一条链状结构</span></span></span></span></span></span></span></div><div><br/></div><div>用一个对象来模拟全局执行上下文---<span style="font-size: 12pt; color: rgb(168, 168, 168);">&gt;Gobal Execution Context = {</span></div><div><span style="font-size: 12pt; color: rgb(168, 168, 168);">                                                                <span style="font-size: 12pt; color: rgb(227, 0, 0);">this:window,</span></span></div><div><span style="font-size: 12pt; color: rgb(227, 0, 0);">                                                                GO = {a:undefined, aa:function() {...}},</span></div><div><span style="font-size: 12pt; color: rgb(227, 0, 0);">                                                               </span> <span style="font-size: 12pt; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;;">ScopeChain</span><span style="font-size: 12pt; color: rgb(227, 0, 0);"> = {0:GO}</span></div><div><span style="font-size: 12pt; color: rgb(227, 0, 0);">    </span><span style="font-size: 12pt; color: rgb(227, 0, 0);">    </span><span style="font-size: 12pt; color: rgb(227, 0, 0);">    </span><span style="font-size: 12pt; color: rgb(227, 0, 0);">    </span><span style="font-size: 12pt; color: rgb(227, 0, 0);">    </span><span style="font-size: 12pt; color: rgb(227, 0, 0);">    </span><span style="font-size: 12pt; color: rgb(227, 0, 0);">    </span><span style="font-size: 12pt; color: rgb(227, 0, 0);">    </span><span style="font-size: 12pt; color: rgb(227, 0, 0);">    </span><span style="font-size: 12pt; color: rgb(227, 0, 0);">    </span><span style="font-size: 12pt; color: rgb(227, 0, 0);">    </span><span style="font-size: 12pt; color: rgb(227, 0, 0);">    </span><span style="font-size: 12pt; color: rgb(227, 0, 0);">    </span><span style="font-size: 12pt; color: rgb(227, 0, 0);">  </span> <span style="font-size: 12pt; color: rgb(168, 168, 168);">   </span><span style="font-size: 12pt; color: rgb(168, 168, 168);">}</span></div><div><span style="font-size: 12pt; color: rgb(168, 168, 168);">   </span> <span style="font-size: 12pt;">全局的预解析完成后，创建好的全局执行上下文也被放到了执行栈中,js引擎每次执行时都会从栈顶开始入手,而此时栈顶只有全局的执行上下文。</span></div><div><span style="font-size: 12pt;">   </span> <span style="font-size: 12pt; color: rgb(227, 0, 0);">PS:每次新创建好的执行上下文都会被放到栈的最顶端,js引擎会优先进入这个环境执行代码,执行完后销毁该执行上下文,意味着该环境中的所有数据都会被销毁,全局上下文在页面关闭时才会销毁。</span></div><div><span style="font-size: 12pt; color: rgb(227, 0, 0);">   </span> <span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">全局的预解析完后:</span></div><div><font style="font-size: 12pt;"><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">            开始一行一行的执行代码,期间对变量声明进行赋值操作,在执行阶段会动态的改变GO里面已经作为属性名的变量名对应的值,</span></font><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">也就是GO = { a: 1, aa:function(){...}}</span></div><div><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">            当执行到aa()这句时,开始了函数的预解析阶段，内部环节与全局预解析基本一致,但</span><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">也有所</span><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">不同</span></div><div><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">           一. 首先创建函数的执行期上下文环境,该环境内初始化</span><span style="font-size: 12pt; background-color: rgb(255, 250, 165); color: rgb(70, 70, 70);-evernote-highlight:true;">ScopeChain</span><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">属性，</span><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">创建VO</span></div><div><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">                A---&gt;</span><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">初始化</span><span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(70, 70, 70);-evernote-highlight:true;">ScopeChain</span><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">的值，值为函数对象的[[Scopes]]属性的值，即: </span><span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(70, 70, 70);-evernote-highlight:true;">ScopeChain</span> <span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">= aa.[[Scopes]] ==&gt; {0:GO}</span></span></div><div><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">                B---&gt;1.在该函数环境内找形参和var变量声明,作为VO对象属性名,值为undefined,  2 arguments.  3.将实参值与形参相统一,  4.找出函数声明,作为属性名,值赋予函数体（若函数名与VO对象的属性名重名,则函数体覆盖同名属性名的值）</span></div><div><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">                C---&gt;创建好VO对象后,VO会自动成为</span><span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(70, 70, 70);-evernote-highlight:true;">ScopeChain</span><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">的第0位,而将GO往后推迟一位,即: ScopeChain = {0:VO, 1: GO}</span></div><div><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">                    VO = {x:22, y:23, name:undefined, sex: undefined}    </span></div><div><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">            二.创建好的执行期上下文环境压入执行栈中,在栈顶放着,此时执行栈的结构为:</span></div><div><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">            <img src="js闭包深入理解_files/EC.png" type="image/png" data-filename="EC.png" style="background-color: rgb(255, 250, 165); font-size: 12pt;"/></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(227, 0, 0);">    </span><span style="font-size: 12pt; color: rgb(227, 0, 0);"> </span> <span style="font-size: 12pt; color: rgb(70, 70, 70);">  三.在aa函数的预解析阶段发现了boy,girl函数的定义,</span><span style="font-size: 12pt; color: rgb(70, 70, 70);">和之前一样,js引擎为girl和boy函数分配一个[[Scopes]]属性,</span></span></div><div><span style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(70, 70, 70);">            初始化其值等于girl和boy函数的最近包含函数(父函数)的[[Scopes]],即:girl.[[Scopes]] 和</span><span style="font-size: 12pt; color: rgb(70, 70, 70);">boy.[[Scopes]]</span><span style="font-size: 12pt; color: rgb(70, 70, 70);">= aa.</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">[[Scopes]---&gt;{0:GO}</span></span></div><div><span style="font-size: 12pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt;"><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">    </span><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">    </span><span style="font-size: 11pt; color: rgb(227, 0, 0); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">  这里发生了奇特现象,js引擎会去看看这两个嵌套的子函数内部是否需要用到它们外部的这个函数环境里的变量,若是嵌套的子函数内部不需要就会看子函数内部的函数看看需要不，</span></span></span></div><div><span style="font-size: 12pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt;"><span style="font-size: 11pt; color: rgb(227, 0, 0); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">              若是要用的话,就会产生一个叫做闭包的东西Closure,该闭包是在这个外部函数环境中形成的</span></span></span></div><div><span style="font-size: 12pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 11pt;"><span style="font-size: 11pt; color: rgb(227, 0, 0); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">              也就是会去看看boy和girl函数里面的代码,</span></span></span><span style="font-size: 11pt; color: rgb(227, 0, 0); font-family: &quot;Open Sans&quot;;"> 把需要用到的变量纪录下来,从外部函数环境中的VO里去找对应的变量,并创建闭包对象，该对象内部有个objcet属性,该属性保存着指向外部函数环境中的那个VO对象的引用,只是在浏览器debugger中只会展示需要用到的变量。</span></div><div><span style="font-size: 11pt; color: rgb(227, 0, 0); font-family: &quot;Open Sans&quot;;">              这时所有子函数的[[Scopes]]的第0位就存放着该闭包对象，即:<span style="font-size: 11pt; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;;">girl.[[Scopes]] 和</span><span style="font-size: 12pt; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;;">boy.[[Scopes]] = {0: Closure{object:{name:undefined, sex: undefined}}, 1:GO}</span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 12pt; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;;">             接着初始化aa函数执行上下文中的ScopeChain属性值 = <span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">{0: Closure{name:undefined, sex: undefined}, 1:GO},</span></span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 12pt;"><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 16px; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">    </span><span style="font-size: 16px; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">    </span><span style="font-size: 16px; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">    </span><span style="font-size: 16px; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="font-size: 16px; color: rgb(255, 70, 53); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">PS:这里保存的都是对aa.[[scopes]]对应值的引用</span></span></span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 12pt;"><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">             然后创建VO，<span style="font-size: 12pt; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">aa函数执行上下文中的ScopeChain属性值变成 = <span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">{0: VO, 1: Closure{name:undefined, sex: undefined}, 2:GO}</span></span></span></span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 12pt;"><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 12pt;"><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">        四.aa函数执行,VO变成AO，变量进行相应的赋值操作,此时环境中的ScopeChain中的引用对应的值也会发生相应的改变</span></span></span></span></span></div><div><span style="font-size: 11pt;"><span style="font-size: 12pt;"><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 12pt;"><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">        五.接着girl函数预解析,过程与aa函数一样,就无须多言啦，下面直接上图,便可一目了然了,</span><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 16px; color: rgb(235, 0, 115); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">this不算在VO对象内,而是在执行环境中的</span></span></span></span></span></span></div><div><img src="js闭包深入理解_files/a11.png" type="image/png" data-filename="a11.png"/></div><div><span style="font-size: 11pt;"><span style="font-size: 12pt;"><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 12pt;"><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">        </span></span></span></span></span></div><div><br/></div><div><span style="font-size: 11pt; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;">    <img src="js闭包深入理解_files/closure.png" type="image/png" data-filename="closure.png" style="font-family: Open Sans; font-size: 11pt; color: rgb(51, 51, 51);"/></span></div><div><span style="font-size: 12pt; color: rgb(173, 0, 0);">PS:执行环境中的</span><span style="font-size: 12pt; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;;">ScopeChain</span><span style="font-size: 12pt; color: rgb(173, 0, 0);">里面存储着的一个个包含了一系列变量名，函数名等等数据的对象的引用,这些对象以线性结构形成,便构成了所谓的作用域链，实际上是一个指针列表。</span></div><div><span style="font-size: 12pt; color: rgb(173, 0, 0);">    js引擎每次查找变量时都会从相应的执行环境中的</span><span style="font-size: 12pt; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;;">ScopeChain</span><span style="font-size: 12pt; color: rgb(173, 0, 0);">顶端去找,以此类推，直到GO对象,没有找到就会报错。这里注意是执行环境中的</span><span style="font-size: 12pt; color: rgb(70, 70, 70); font-family: &quot;Open Sans&quot;;">ScopeChain</span><span style="font-size: 12pt; color: rgb(173, 0, 0);">(作用域链)中依次查找。</span></div><div><br/></div><div>这里补充一个知识点，可能有人会问,函数作用域与函数执行环境的关系是什么呢? 解释玩这个，那个全局的作用域与全局的执行环境也就好说了</div><div>解释:  函数执行环境中包含了什么呢？ 1.AO对象，而该对象内有着一系列在函数内部中声明的变量和arguments  2.this  3.ScopeChain 4.执行的代码(这里上面没讲)</div><div>想一想变量是放在哪儿了，当然是AO对象内了,所以啊这个函数作用域就类似一堵围墙也可理解为规则，包围着函数的执行环境,不许外部访问，想要访问只能是拿到对应执行环境中的AO对象的引用，然后放到自身执行环境中的作用域链(ScopeChain)的顶端去,而只有子函数能拿到，且是通过函数的[[scopes]]属性拿到的，外部函数无法拿到。所以说函数外部无法访问函数内部的变量也就说的通了。</div><div><br/></div><div><br/></div><div><span style="font-size: 12pt;">到这里相信大家已经对闭包这个神圣的东西有所了解了，接着就来说说闭包的存在导致的内存泄露的原因吧</span></div><div><span style="font-size: 12pt;">内存泄漏:一个专业名词,通俗解释就是由于内存空间得不到释放,导致可用内存空间的不足,也就是可用内存的泄露，这就叫内存泄漏</span></div><div><br/></div><div><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">由于在函数内部嵌套子函数,并且子函数内部要用到父函数执行环境中的变量，这产生了一个闭包对象,也就是向内存开辟了一个空间来存储这个复杂类型的值，</span></div><div><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">而这个闭包的引用会被保存在子函数的[[Scopes]]属性里去,每次调用子函数时,其产生的执行环境中的ScopeChain中就会存在这个闭包的引用,至于为什么存在上面有讲解,</span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">虽然函数执行完后销毁了该函数的执行环境,环境中的闭包引用随之销毁了,但是</span><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">函数的[[Scopes]]属性里还存着该闭包对象的引用，</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">(</span><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">在return语句执行完之后该函数的执行上下文被销毁,而在执行return语句时)</span><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">若</span><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">该函数被保存在了外部且引用被外部变量接收，</span></span></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">那么这个外部变量就保存函数引用,指向原来那个函数,而此时那个函数中的[[Scopes]]还存着那个闭包,这样就一直占用着内存,导致内存泄漏,尽管</span><span style="font-size: 12pt;background-color: rgb(255, 250, 165);-evernote-highlight:true;">销毁了该函数的执行环境</span></span></div><div><img src="js闭包深入理解_files/cc.png" type="image/png" data-filename="cc.png" style="font-size: 12pt;"/></div><div><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">要想防止内存泄漏,那么在使用完闭包后手动将cc = null,这样就没有地址指向存着闭包对象的那个函数了,</span></div><div><span style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;">而js的垃圾回收制会周期性的回收那些不用的变量,当这个函数不再被调用时,该函数[[Scopes]]里指向的那个闭包对象里的变量就会被回收,释放内存</span></div></span>
</div></body></html> 