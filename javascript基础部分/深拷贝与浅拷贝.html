<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <script>
        let obj1 = {
            arr: [1, 2, 3],
            name: 'xxx',
            book: {
                page: 3,
                price: 30
            }
        }
        Object.prototype.x = 1;
        let obj2 = {};
        deepClone(obj2, obj1);
        console.log(obj2);
        function deepClone(target, source) {
            for (key in source) {
                if (source.hasOwnProperty(key)) {
                    if ( source[key] && source[key] instanceof Object ) {//complex data type
                        let subSource = new source[key].constructor;
                        target[key] = subSource;
                        deepClone(subSource, source[key]);
                    } else {//basic data type
                        target[key] = source[key];
                    }
                }
            }
        }


        //1.判断是不是原始值,typeof()
        //2.判断是数组还是对象constructor,instanceof ,toString().call(),建议用第三种
        //3.建立相应的数组或对象
        function deepClone(origin, target) {
            var target = target || {},//若用户不添加目标对象，则系统自动添加一个空对象，兼容性
                str = "[object Array]",
                toStr = Object.prototype.toString;
            for (var prop in origin) {
                if (origin.hasOwnProperty(prop)) {//避免取到origin原型链上的属性
                    if (origin[prop] !== "null" && typeof (origin[prop]) == "object") {//判断是不是原始值,typeof()
                        if (toStr.call(origin[prop]) == str) {
                            //判断原始对象里的属性值是数组还是对象，是数组则给目标对象建立一个同属性名的空数组
                            target[prop] = [];
                        }
                        else {
                            target[prop] = {};
                        }
                        //给目标对象的属性值取为(该属性名和原始属性名一致)一个空数组或空对象后,利用递归思想在
                        //一次遍历原始对象属性值为对象或数组的这个对象，并把对应的原始值copy给目标对象的属性
                        //这里的origin[prop]即为一个属性值为对象或数组的的对象
                        deepClone(origin[prop], target[prop]);
                    }
                    else {
                        target[prop] = origin[prop];//原始值直接copy
                    }
                }
            }
            return target;
        } 
    </script>
</body>

</html>