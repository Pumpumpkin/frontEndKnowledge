<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
    * {
        margin: 0;
        padding: 0;
        list-style-type: none;
    }

    .wrapper {
        width: 542px;
        margin-left: 50px;
    }

    .wrapper ul {
        padding: 10px;
        overflow: hidden;
        border: 1px solid #000;
    }
	.wrapper ul li {
		margin-top: 20px;
		overflow: hidden;
	}
    .wrapper ul li div {
        float: left;
    }

    .img-wrap {
        position: relative;
    }

    .enroll {
        position: absolute;
        bottom: 0;
        left: 10px;
        color: #f2f3f2;
    }

    img {
        display: block;
        width: 200px;
    }

    .price {
        color: #f40;
        display: block;
    }

    .free {
        color: green;
    }

    .content-wrap {
        margin-left: 15px;
    }

    .content-wrap p.name {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 300px;
    }

    .playback {
        color: blue;
        background-color: #ddd;
        display: inline-block;
    }
    .total {
    	color: #233;
    	font-weight: bolder;
    	font-size: 30px;
		margin-top: 20px;
    }
    .active {
    	opacity: 0.3;
    }
    </style>
</head>

<body>
    <!-- <div class="wrapper" id="app">
        <ul>
            <li>
                <div class="img-wrap">
                    <img src="https://10.url.cn/qqcourse_logo_ng/ajNVdqHZLLBsSud06XlZnJACsTWd7OSA5phIFPRTNibFBeuT8jRjy00Jb5ticSEKYUnpUYdBCicH2U/356" alt="">
                    <p class="enroll">报名人数<span>4942</span></p>
                </div>
                <div class="content-wrap">
                    <p class="name">Web前端开发之JavaScript(Js)精英课堂【渡一教育】</p>
                    <p class="free">免费</p>
                    <p class="price">0</p>
                    <p class="playback">回放</p>
                </div>
            </li>
        </ul>
    </div> -->
    <div class="wrapper" id="app">
		<course-list :list="courseList"></course-list>	    		
    </div>
    <script src="vue.js"></script>
    <script>
   	var courseLists = {
        	props: {
        		list: {
        			type: Array
        		}
        	},
        	data() {
        		return {
        			totalPrice: 0,
        			totalArr: [],
        			selectedArr: []
        		}
        	},
			template: `<ul>
					       	<li v-for="(item, index) in list">
				                <div v-on:click="[addToCart(item.price, index)]" v-on:contextmenu.prevent="cancelLesson(item.price,index)" class="img-wrap" :class="{active:selectedArr[index]}">
				                    <img :src=item.poster>
				                    <p class="enroll">报名人数<span>{{item.enrollment}}</span></p>
				                </div>
				                <div class="content-wrap">
				                    <p class="name">{{item.name}}</p>
				                    <p class="free" v-show="item.free">免费</p>
				                    <p class="price">{{item.price}}</p>
				                    <p class="playback v-show=item.playback">回放</p>
				                </div>
					        </li>
					        <p class="total">总计:{{totalPrice}}</p>
					    </ul>`,
			methods: {
        		addToCart(price, index) {
        			if(this.selectedArr[index]) {//避免多次点击同一课程造成的代码重复加购
        				return;
        			}
    				this.totalArr.push(price)
    				this.$set(this.selectedArr, index, true);
    				/*this.selectedArr[index] = true;//不能动态渲染DOM,js无法检测数组成员的变化
    				this.selectedArr.splice(index, 1, true)//vue对splice重写了,可以检测数组成员的变化*/
	    			console.log(this.totalArr)
	    			console.log(this.selectedArr)
	    			this.getTotalPrice(this.totalArr);
        		},
        		getTotalPrice(priceArr) {
        			if(priceArr.length !== 0) {
        				this.totalPrice = priceArr.reduce((total, ele) => {
        					return total + ele;
        				})
        			}else {
        				this.totalPrice = 0;
        			}
        			
        		},
        		cancelLesson(price, index) {
        			if(!this.selectedArr[index]) {
        				return;
        			}
        			//取消加购的课程-->取消用于选中的类名active
        			this.selectedArr.splice(index, 1, false);
        			//通过价格找到取消加购的课程对应的索引
        			const lastIndex = this.totalArr.findIndex((item) => {
        				return item === price;
        			})
        			this.totalArr.splice(lastIndex, 1)
        			console.log(this.totalArr)
        			this.getTotalPrice(this.totalArr)
        		}
        	}
   	}
    new Vue({
        el: '#app',
        data: {
            courseList: [{
                    name: 'Web前端开发之JavaScript(Js)精英课堂【渡一教育】',
                    free: true,
                    playback: false,
                    price: 0,
                    buyNumber: 0,
                    enrollment: 4942,
                    poster: 'https://10.url.cn/qqcourse_logo_ng/ajNVdqHZLLBsSud06XlZnJACsTWd7OSA5phIFPRTNibFBeuT8jRjy00Jb5ticSEKYUnpUYdBCicH2U/356'
                },
                {
                    name: 'Web前端开发之HTML+CSS精英课堂【渡一教育】',
                    free: true,
                    playback: false,
                    price: 0,
                    buyNumber: 0,
                    enrollment: 2982,
                    poster: 'https://10.url.cn/qqcourse_logo_ng/ajNVdqHZLLBDFLdArBwf70PjMrL6bq0OI9LesEsskk1iamJKibriaic0QkBZhINoDuN0DicaojkqyQjk/356'
                },
                {
                    name: '淘宝商城项目实战开发【渡一教育】',
                    free: true,
                    playback: false,
                    price: 0,
                    buyNumber: 0,
                    enrollment: 1742,
                    poster: 'https://10.url.cn/qqcourse_logo_ng/ajNVdqHZLLDBpXKL1sgAOKcbSz0Od2abiaqdJibiaDDQWfmrVNBCFrIpbTQKlNyWbPg5Uo1dnT7Znk/356'
                },
                {
                    name: '零基础WEB前端入门',
                    free: false,
                    playback: true,
                    price: 9.9,
                    buyNumber: 2514,
                    enrollment: 0,
                    poster: 'https://10.url.cn/qqcourse_logo_ng/ajNVdqHZLLCRlDgtxVbmyclxP9fDUYmnuqAFbN5mYsncrPrVyQbtA3fNfuZ3qicSe1r7Ppt7tICs/356'
                },
                {
                    name: 'React顶级企业实战，全流程制作淘票票WebApp【渡一教育】',
                    free: false,
                    playback: true,
                    price: 399,
                    buyNumber: 670,
                    enrollment: 0,
                    poster: 'https://10.url.cn/qqcourse_logo_ng/ajNVdqHZLLB2CyXIxsb8iaAUibBB9mzlkSgKNU7GiciaYxG1SicoLjkiahZ3ia54eZWbtCGDkFyvMo0uKk/356'
                },
                {
                    name: '原生JS贪吃蛇游戏实战开发【渡一教育】',
                    free: true,
                    playback: false,
                    price: 0,
                    buyNumber: 0,
                    enrollment: 1123,
                    poster: 'https://10.url.cn/qqcourse_logo_ng/ajNVdqHZLLCfsOGnxjhUXFA6SHMOu0fMUicuucRlIVNo9zBnnLiacovMnePD6586QlRj2qvwudbn8/356'
                },
                {
                    name: '原生JS扫雷游戏实战开发【渡一教育】',
                    free: true,
                    playback: false,
                    price: 0,
                    buyNumber: 0,
                    enrollment: 631,
                    poster: 'https://10.url.cn/qqcourse_logo_ng/ajNVdqHZLLDaTljUSVGk2eqS1MCT3DwDqxgs7KhfMf3411SXQkRvmiaicIuz47ydO27zGPWK97wicw/356'
                },
                {
                    name: '你不知道的Javascript【渡一教育】',
                    free: true,
                    playback: false,
                    price: 0,
                    buyNumber: 0,
                    enrollment: 1696,
                    poster: 'https://10.url.cn/qqcourse_logo_ng/ajNVdqHZLLCelo2lyibtrxDia7aq7tC0LE1Lcz2LVoDqhQy5tnOHicTzWhLuvPekL35rEmwTdgNuwI/356'
                }
            ]
        },
        components: {
        	'course-list': courseLists
        }
    })
    </script>
</body>

</html>